{% extends "base.html" %}

{% block content %}

<h1 class="text-3xl font-bold mb-6 text-gray-800">
  Inventory Management
</h1>

<!-- Add / Edit Product Form -->
<div class="bg-white p-6 rounded-xl shadow-md mb-8">

  <h3 class="text-xl font-semibold mb-4">
    {{ 'Edit Product' if edit_item else 'Add New Product' }}
  </h3>

  <form action="{{ url_for('inventory') }}" method="POST" class="grid grid-cols-1 md:grid-cols-3 gap-4">

    <input type="text" name="id" placeholder="Product ID"
      value="{{ edit_item.id if edit_item else '' }}"
      {{ 'readonly' if edit_item else '' }}
      required
      class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">

    <input type="text" name="name" placeholder="Product Name"
      value="{{ edit_item.name if edit_item else '' }}"
      required
      class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">

    <input type="text" name="category" placeholder="Category"
      value="{{ edit_item.category if edit_item else '' }}"
      required
      class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">

    <input type="number" name="stock" placeholder="Stock"
      value="{{ edit_item.stock if edit_item else '' }}"
      min="0" required
      class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">

    <input type="number" name="price" placeholder="Price"
      value="{{ edit_item.price if edit_item else '' }}"
      min="0" step="0.01" required
      class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">

    <input type="date" name="expiry_date"
      value="{{ edit_item.expiry_date if edit_item else '' }}"
      class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">

    <input type="text" name="supplier" placeholder="Supplier"
      value="{{ edit_item.supplier if edit_item else '' }}"
      required
      class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">

    <div class="flex items-center gap-3 md:col-span-3 mt-2">
      <button type="submit"
        class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">
        {{ 'Update Product' if edit_item else '+ Add Product' }}
      </button>

      {% if edit_item %}
      <a href="{{ url_for('inventory') }}"
         class="text-gray-600 hover:underline">
        Cancel Edit
      </a>
      {% endif %}
    </div>

  </form>
</div>

<!-- Search -->
<input type="text" id="searchInput" onkeyup="searchTable()"
  placeholder="ðŸ” Search products..."
  class="w-full px-4 py-2 border rounded-lg mb-4 focus:ring-2 focus:ring-green-500">

<!-- Inventory Table -->
<div class="bg-white rounded-xl shadow-md overflow-x-auto">
  <table class="min-w-full text-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="p-3 text-left">ID</th>
        <th class="p-3 text-left">Name</th>
        <th class="p-3 text-left">Category</th>
        <th class="p-3 text-center">Stock</th>
        <th class="p-3 text-center">Price</th>
        <th class="p-3 text-left">Expiry</th>
        <th class="p-3 text-left">Supplier</th>
        <th class="p-3 text-center">Actions</th>
      </tr>
    </thead>

    <tbody>
      {% for item in items %}
      <tr class="border-t hover:bg-gray-50">
        <td class="p-3">{{ item.id }}</td>
        <td class="p-3">{{ item.name }}</td>
        <td class="p-3">{{ item.category }}</td>
        <td class="p-3 text-center">{{ item.stock }}</td>
        <td class="p-3 text-center">â‚¹{{ item.price }}</td>
        <td class="p-3">{{ item.expiry_date }}</td>
        <td class="p-3">{{ item.supplier }}</td>
        <td class="p-3 text-center space-x-3">
          <a href="{{ url_for('edit_product', item_id=item.id) }}"
             class="text-blue-600 hover:underline">
            Edit
          </a>
          <a href="{{ url_for('delete_item', item_id=item.id) }}"
             onclick="return confirm('Are you sure you want to delete this item?');"
             class="text-red-600 hover:underline">
            Delete
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Search Script -->
<script>
function searchTable() {
  const input = document.getElementById("searchInput").value.toUpperCase();
  const rows = document.querySelectorAll("tbody tr");

  rows.forEach(row => {
    const name = row.children[1].innerText.toUpperCase();
    const category = row.children[2].innerText.toUpperCase();
    row.style.display =
      name.includes(input) || category.includes(input) ? "" : "none";
  });
}
</script>

{% endblock %}
